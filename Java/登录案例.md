# 登录案例

*综合JDBC与Servlet，非常简单*

***

* 具体的效果就是输入用户名与密码，判断登录成功与否
* `username=admin&&password=123`![image-20191025112952081](image-20191025112952081.png)
* `username=admin&&password=12321`![image-20191025113040720](image-20191025113040720.png)

## 分析

*需要关心的是网页端输入的数据如何走向的*

从网页输入后，都做了些什么？跳转至相应的`Servlet`

```java
@WebServlet(urlPatterns = "/loginServlet")//设置注解参数要细心
public class LoginServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        req.setCharacterEncoding("utf-8");
        String username = req.getParameter("username");
        String password = req.getParameter("password");
        User user = new User();
        user.setUsername(username);
        user.setPassword(password);//至此，从网页接收的数据被用来生成一个User
        UserDao ud = new UserDao();//生成Dao(Data Access Object)
        User result = ud.login(user);//生成Dao用来与数据库交互
        if(result == null){
            req.getRequestDispatcher("/failServlet").forward(req, resp);
        }else {
            req.setAttribute("user", user);
            req.getRequestDispatcher("/successServlet").forward(req, resp);
        }//根据交互的结果来确定要转至哪个页面
    }
    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
    }
}
```

```java
public class User {
    private int id;
    private String username;
    private String password;
    //以及各种setter getter toString等
}
```

```java
public class UserDao {
    private JdbcTemplate template = new JdbcTemplate(JDBCUtils.getDataSource());//使用Template简化连接
    public User login(User user){//当然传入user对象
        try {
            String sql = "select * from user where username = ? and password = ?";//生成sql语句
            User user1 = template.queryForObject(sql, new BeanPropertyRowMapper<User>(User.class), user.getUsername(), user.getPassword());//这里用来填充sql中的问号
            return user1;//查询成功就将user返回
        } catch (DataAccessException e){
            e.printStackTrace();
            return null;//如果没有这个记录就返回空值
        }
    }
}
```

